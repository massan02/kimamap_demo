# 気ままっぷ 機能実装優先順位（ゼロから構築）

## 前提条件

- **現状**: 空のディレクトリ（Spec Kitテンプレートのみ）
- **目標**: 最小構成から段階的に機能追加
- **方針**: 動くものを早く作り、反復的に改善

---

## Phase 1: プロジェクト基盤構築（1-2日目）

### 目標
アプリが起動し、基本的な画面遷移ができる状態

### 1-1. Expoプロジェクトのセットアップ ⭐⭐⭐
**優先度: 最高**

```bash
npx create-expo-app@latest . --template blank-typescript
```

- [ ] Expo SDK 54のインストール
- [ ] TypeScript設定
- [ ] 基本的なディレクトリ構造作成
- [ ] 動作確認（Hello World表示）

**理由**: プロジェクトの基盤
**依存**: なし
**所要時間**: 30分

---

### 1-2. ナビゲーション構築 ⭐⭐⭐
**優先度: 最高**

- [ ] React Navigation インストール
- [ ] Bottom Tabs Navigator 実装（3タブ）
  - Map タブ
  - 保存済み タブ
  - マイページ タブ
- [ ] Stack Navigator 実装（検索画面など）
- [ ] ダミー画面作成（各タブ用）

**理由**: アプリの骨格
**依存**: 1-1完了後
**所要時間**: 2-3時間

```
app/
├── navigation/
│   ├── BottomTabNavigator.tsx
│   └── types.ts
└── screens/
    ├── MapScreen.tsx
    ├── SavedScreen.tsx
    └── ProfileScreen.tsx
```

---

### 1-3. 認証機能実装 ⭐⭐⭐
**優先度: 最高**

- [ ] Supabase プロジェクト作成・設定
- [ ] Supabase JS Client インストール
- [ ] Google OAuth 設定（Supabaseコンソール）
- [ ] AuthContext 実装（セッション管理）
- [ ] ログイン画面実装
- [ ] ログアウト機能実装
- [ ] 認証状態による画面分岐

**理由**: ユーザーデータを扱うための前提
**依存**: 1-2完了後
**所要時間**: 4-5時間

```
app/
├── contexts/
│   └── AuthContext.tsx
├── screens/
│   └── LoginScreen.tsx
└── config/
    └── supabase.ts
```

---

**Phase 1 完了時点**: アプリ起動 → ログイン → 3画面のタブ切り替え可能

---

## Phase 2: 地図表示機能（3-4日目）

### 目標
地図を表示し、現在地を取得できる状態

### 2-1. Google Maps 基本表示 ⭐⭐⭐
**優先度: 最高**

- [ ] react-native-maps インストール
- [ ] Google Maps API キー取得・設定
- [ ] MapScreen に地図表示
- [ ] 初期表示位置設定（福岡市など）
- [ ] 地図操作確認（ズーム、パン）

**理由**: アプリのコア画面
**依存**: Phase 1完了後
**所要時間**: 2-3時間

---

### 2-2. 位置情報取得 ⭐⭐⭐
**優先度: 最高**

- [ ] expo-location インストール
- [ ] 位置情報パーミッション取得
- [ ] 現在地取得機能実装
- [ ] 現在地に地図を移動
- [ ] 現在地マーカー表示

**理由**: ユーザーの現在地を起点にプラン作成
**依存**: 2-1完了後
**所要時間**: 2-3時間

---

### 2-3. 検索バーUI ⭐⭐
**優先度: 高**

- [ ] 地図画面上部に検索バー配置
- [ ] タップで検索画面に遷移（Stack Navigator）
- [ ] 基本的なスタイリング

**理由**: ユーザーがプラン作成を開始するエントリーポイント
**依存**: 2-1完了後（2-2と並行可能）
**所要時間**: 1-2時間

---

### 2-4. 天気ウィジェット（オプション）⭐
**優先度: 中**

- [ ] Open-Meteo API 統合
- [ ] 現在地の天気情報取得
- [ ] 天気ウィジェットUI作成
- [ ] 地図画面に配置

**理由**: UX向上（後回しでもOK）
**依存**: 2-2完了後
**所要時間**: 2-3時間

---

**Phase 2 完了時点**: 地図表示 + 現在地取得 + 検索画面への導線完成

---

## Phase 3: 検索・プラン機能（5-7日目）

### 目標
ユーザーが検索 → AIがプランを提案 → 地図に表示

### 3-1. 検索画面UI実装 ⭐⭐⭐
**優先度: 最高**

- [ ] 要望入力フィールド（テキストエリア）
- [ ] 移動手段選択（徒歩・自転車・自動車・公共交通機関）
- [ ] 時間選択（時間・分のピッカー）
- [ ] 気分選択（オプション）
- [ ] 検索ボタン
- [ ] バリデーション実装

**理由**: ユーザー入力を受け付ける
**依存**: Phase 2完了後
**所要時間**: 3-4時間

```
app/screens/SearchScreen.tsx
```

---

### 3-2. バックエンドサーバー構築 ⭐⭐⭐
**優先度: 最高**

- [ ] `server/` ディレクトリ作成
- [ ] Express 5.1 インストール・設定
- [ ] TypeScript設定
- [ ] `/api/plan` エンドポイント作成（POST）
- [ ] リクエスト型定義（Zod）
- [ ] 開発サーバー起動確認

**理由**: AIプランロジックを実行する場所
**依存**: Phase 2完了後（3-1と並行可能）
**所要時間**: 2-3時間

```
server/
├── src/
│   ├── index.ts
│   ├── routes/
│   │   └── planRoutes.ts
│   ├── controllers/
│   │   └── planController.ts
│   └── types/
│       └── schemas.ts
├── package.json
└── tsconfig.json
```

---

### 3-3. モックデータ作成 ⭐⭐
**優先度: 高**

- [ ] 福岡エリアのスポットデータ作成（JSON）
  - 名前、カテゴリ、座標、滞在時間
- [ ] 20-30件のスポットデータ
- [ ] スポット読み込み処理実装

**理由**: AIプランロジックのデータソース
**依存**: 3-2完了後
**所要時間**: 2-3時間

```
server/data/spots.json
```

---

### 3-4. AIプランロジック実装 ⭐⭐⭐
**優先度: 最高**

- [ ] ユーザー入力からスポット選択アルゴリズム
  - 時間制約内に収まるスポット組み合わせ
  - 移動手段に応じた移動時間計算
  - 気分に合わせたカテゴリフィルタリング
- [ ] ルート最適化（貪欲法・巡回セールスマン問題の簡易版）
- [ ] レスポンス生成
- [ ] テスト実装

**理由**: アプリのコア機能
**依存**: 3-3完了後
**所要時間**: 5-6時間

---

### 3-5. フロントエンド-バックエンド接続 ⭐⭐⭐
**優先度: 最高**

- [ ] APIクライアント実装（fetch/axios）
- [ ] 検索ボタン押下時にAPIリクエスト送信
- [ ] レスポンス受信・パース
- [ ] ローディング状態表示
- [ ] エラーハンドリング
- [ ] CORS設定

**理由**: フロントとバックを繋ぐ
**依存**: 3-2, 3-4完了後
**所要時間**: 2-3時間

```
app/services/api.ts
```

---

### 3-6. 地図上のルート描画 ⭐⭐⭐
**優先度: 最高**

- [ ] プラン取得後、地図画面に遷移
- [ ] `Polyline` でルート描画
- [ ] 複数スポット間のルート表示
- [ ] 地図の自動ズーム調整（全ルートが見える範囲）
- [ ] ルート色・太さの調整

**理由**: プラン結果の視覚化
**依存**: 3-5完了後
**所要時間**: 2-3時間

---

### 3-7. 地図上のマーカー表示 ⭐⭐⭐
**優先度: 最高**

- [ ] スポットごとにマーカー配置
- [ ] マーカー番号表示（訪問順: 1→2→3...）
- [ ] マーカータップでスポット情報表示（Callout）
  - スポット名、滞在時間、カテゴリ
- [ ] カスタムマーカーデザイン（オプション）

**理由**: どこに行くのかを明確にする
**依存**: 3-6と並行可能
**所要時間**: 2-3時間

---

**Phase 3 完了時点**: MVP完成（検索 → AIプラン生成 → 地図表示）

---

## Phase 4: データ永続化・履歴機能（8-9日目）

### 目標
ユーザーがプランを保存・再利用できる

### 4-1. Supabaseテーブル設計 ⭐⭐
**優先度: 高**

- [ ] `plans` テーブル作成
  ```sql
  - id (UUID)
  - user_id (UUID, foreign key)
  - title (text)
  - spots (jsonb)
  - route (jsonb)
  - is_favorite (boolean)
  - created_at (timestamp)
  ```
- [ ] RLS（Row Level Security）設定
- [ ] テーブル作成SQLの実行

**理由**: データを永続化する基盤
**依存**: Phase 3完了後
**所要時間**: 1-2時間

---

### 4-2. 履歴保存機能 ⭐⭐
**優先度: 高**

- [ ] プラン生成後、自動でSupabaseに保存
- [ ] 保存APIクライアント実装
- [ ] エラーハンドリング

**理由**: ユーザーが過去のプランを見返せる
**依存**: 4-1完了後
**所要時間**: 2-3時間

---

### 4-3. 保存済み画面実装 ⭐⭐
**優先度: 高**

- [ ] Supabaseから履歴取得
- [ ] リスト表示（FlatList）
  - タイトル、日時、スポット数
- [ ] タップでプラン詳細表示
- [ ] プラン詳細画面実装
  - スポットリスト
  - 地図で見る ボタン（地図画面に遷移してルート表示）

**理由**: 保存したプランを確認・再利用
**依存**: 4-2完了後
**所要時間**: 3-4時間

---

### 4-4. お気に入り機能 ⭐⭐
**優先度: 高**

- [ ] プラン詳細画面に「お気に入り」ボタン追加
- [ ] Supabase更新処理（`is_favorite` フラグ）
- [ ] 保存済み画面でお気に入りフィルター
- [ ] お気に入り解除機能

**理由**: 特に気に入ったプランをブックマーク
**依存**: 4-3完了後
**所要時間**: 2-3時間

---

**Phase 4 完了時点**: プランの保存・履歴・お気に入り機能が完成

---

## Phase 5: マイページ・その他機能（10-12日目）

### 5-1. マイページ実装 ⭐
**優先度: 中**

- [ ] ユーザー情報表示
  - Google アカウント名
  - プロフィール画像
- [ ] 統計情報表示
  - 生成プラン数
  - お気に入り数
- [ ] ログアウトボタン

**理由**: ユーザーエンゲージメント向上
**依存**: Phase 4完了後
**所要時間**: 2-3時間

---

### 5-2. AIおすすめ機能（基本版）⭐
**優先度: 低**

- [ ] 検索画面に「おすすめ」セクション追加
- [ ] ハードコード3件のおすすめ表示
- [ ] タップで検索フォームに自動入力

**理由**: 検索の手間を省く
**依存**: Phase 3完了後
**所要時間**: 1-2時間

---

### 5-3. プラン編集機能 ⭐
**優先度: 低**

- [ ] スポット順序の変更（ドラッグ&ドロップ）
- [ ] スポットの削除
- [ ] スポットの追加（検索から）
- [ ] 編集内容の保存

**理由**: プランのカスタマイズ性向上
**依存**: Phase 4完了後
**所要時間**: 5-6時間

---

### 5-4. 設定画面
**優先度: 低**

- [ ] デフォルト移動手段設定
- [ ] デフォルト時間設定
- [ ] アプリ情報（バージョン、利用規約）

**理由**: UX向上
**依存**: なし
**所要時間**: 2-3時間

---

### 5-5. UI/UX改善
**優先度: 低**

- [ ] ローディングアニメーション
- [ ] 画面遷移アニメーション
- [ ] エラーメッセージの改善
- [ ] アクセシビリティ対応
- [ ] レスポンシブデザイン調整

**理由**: プロダクト品質向上
**依存**: 継続的
**所要時間**: 継続的

---

## 実装順序サマリー

| Phase | タスク | 所要時間 | 累計 |
|-------|--------|----------|------|
| 1-1 | Expoセットアップ | 30分 | 0.5h |
| 1-2 | ナビゲーション構築 | 2-3h | 3.5h |
| 1-3 | 認証機能実装 | 4-5h | 8.5h |
| 2-1 | Google Maps表示 | 2-3h | 11.5h |
| 2-2 | 位置情報取得 | 2-3h | 14.5h |
| 2-3 | 検索バーUI | 1-2h | 16.5h |
| 2-4 | 天気ウィジェット（オプション）| 2-3h | 19.5h |
| 3-1 | 検索画面UI | 3-4h | 23.5h |
| 3-2 | バックエンド構築 | 2-3h | 26.5h |
| 3-3 | モックデータ作成 | 2-3h | 29.5h |
| 3-4 | AIプランロジック | 5-6h | 35.5h |
| 3-5 | フロント-バックエンド接続 | 2-3h | 38.5h |
| 3-6 | ルート描画 | 2-3h | 41.5h |
| 3-7 | マーカー表示 | 2-3h | 44.5h |
| 4-1 | Supabaseテーブル設計 | 1-2h | 46.5h |
| 4-2 | 履歴保存機能 | 2-3h | 49.5h |
| 4-3 | 保存済み画面 | 3-4h | 53.5h |
| 4-4 | お気に入り機能 | 2-3h | 56.5h |

**MVP完成（Phase 3完了）**: 約40-45時間（実働5-6日）
**主要機能完成（Phase 4完了）**: 約50-57時間（実働7-8日）

---

## 開発の進め方

### 1週目（MVP完成目標）
- Day 1: Phase 1（プロジェクト基盤）
- Day 2-3: Phase 1（認証機能）
- Day 4: Phase 2（地図表示）
- Day 5-7: Phase 3（検索・プラン機能）

### 2週目（主要機能完成）
- Day 8-9: Phase 4（データ永続化）
- Day 10-12: Phase 5（その他機能）+ バグ修正

---

## 次のアクション

1. **Phase 1-1 から着手**
   ```bash
   cd /Users/murasakimasato/school/kimamap_demo
   npx create-expo-app@latest . --template blank-typescript
   ```

2. **各フェーズの開始前に `/speckit.tasks` でタスク分解**

3. **実装は `/speckit.implement` で実行**

4. **定期的に動作確認・テスト**

**最初の一歩**: Expoプロジェクトのセットアップから開始してください。
